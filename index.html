<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAS 개편안</title>
    <style>
        ul {
            list-style-type: none;
            padding-left: 20px;
        }

        .folder {
            cursor: pointer;
            font-weight: bold;
        }

        .folder::before {
            content: "📂 ";
        }

        .file::before {
            content: "📄 ";
        }

        .hidden {
            display: none;
        }

        li {
            margin: 5px 0;
            padding: 5px;
            cursor: grab;
            border: none;
            background-color: transparent;
        }

        .dragging {
            opacity: 1;
            border: 2px dashed #007bff;
        }

        .drag-over {
            background-color: #e0f7fa;
        }
    </style>
</head>
<body>

<h2>NAS 개편안</h2>
<ul id="folderTree">
    <li draggable="true">
        <span class="folder" onclick="toggleFolder(this)">31-용역</span>
        <button onclick="addFolderOrFile(this, true)">추가</button>
        <ul>
            <li draggable="true">
                <span class="folder" onclick="toggleFolder(this)">00-WORK0000</span>
                <button onclick="addFolderOrFile(this, false)">추가</button>
                <button onclick="editName(this)">편집</button>
                <button onclick="removeFolder(this)">삭제</button>
                <ul>
                    <li draggable="true"><span class="file">구조설계 및 검토</span>
                        <button onclick="editName(this)">편집</button>
                        <button onclick="removeFolder(this)">삭제</button>
                    </li>
                    <li draggable="true"><span class="file">내진성능평가</span>
                        <button onclick="editName(this)">편집</button>
                        <button onclick="removeFolder(this)">삭제</button>
                    </li>
                    <li draggable="true"><span class="file">성능기반설계</span>
                        <button onclick="editName(this)">편집</button>
                        <button onclick="removeFolder(this)">삭제</button>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ul>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("ul").forEach(ul => ul.classList.remove("hidden"));
    });

    function toggleFolder(folder) {
        const subList = folder.nextElementSibling.nextElementSibling;
        if (subList && subList.tagName === "UL") {
            subList.style.display = subList.style.display === "none" ? "block" : "none";
        }
    }

    function addFolderOrFile(button, isFolder) {
        const parentLi = button.parentElement;
        let ul = parentLi.querySelector("ul");
        if (!ul) {
            ul = document.createElement("ul");
            parentLi.appendChild(ul);
        }
        const newLi = document.createElement("li");
        newLi.draggable = true;
        newLi.addEventListener("dragstart", dragStart);
        newLi.addEventListener("dragover", dragOver);
        newLi.addEventListener("dragleave", dragLeave);
        newLi.addEventListener("drop", drop);

        const newItem = document.createElement("span");
        if (isFolder) {
            newItem.classList.add("folder");
            newItem.textContent = "새 폴더";
            newItem.onclick = function () { toggleFolder(newItem); };
        } else {
            newItem.classList.add("file");
            newItem.textContent = "새 파일";
        }
        
        const addBtn = document.createElement("button");
        addBtn.textContent = "추가";
        addBtn.onclick = function () { addFolderOrFile(addBtn, !isFolder); };
        
        const editBtn = document.createElement("button");
        editBtn.textContent = "편집";
        editBtn.onclick = function () { editName(editBtn); };

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "삭제";
        removeBtn.onclick = function () { removeFolder(removeBtn); };
        

        newLi.appendChild(newItem);
        if (isFolder) {
            newLi.appendChild(addBtn);
        }
        newLi.appendChild(editBtn);
        newLi.appendChild(removeBtn);
        ul.appendChild(newLi);
    }

    function removeFolder(button) {
        const parentLi = button.parentElement;
        if (parentLi.parentElement) {
            parentLi.parentElement.removeChild(parentLi);
        }
    }

    function editName(button) {
        const nameSpan = button.parentElement.querySelector("span");
        const newName = prompt("새 이름을 입력하세요:", nameSpan.textContent);
        if (newName !== null && newName.trim() !== "") {
            nameSpan.textContent = newName;
        }
    }

    function dragStart(event) {
        event.dataTransfer.setData("text/plain", event.target.id);
        event.target.classList.add("dragging");
    }

    function dragOver(event) {
        event.preventDefault();
        event.target.classList.add("drag-over");
    }

    function dragLeave(event) {
        event.target.classList.remove("drag-over");
    }

    function drop(event) {
        event.preventDefault();
        event.target.classList.remove("drag-over");
        const draggedElement = document.querySelector(".dragging");
        if (draggedElement) {
            draggedElement.classList.remove("dragging");
            const dropTarget = event.target.closest("li");
            if (dropTarget && dropTarget.parentElement) {
                dropTarget.parentElement.insertBefore(draggedElement, dropTarget);
            }
        }
    }

    document.querySelectorAll("li").forEach(item => {
        item.addEventListener("dragstart", dragStart);
        item.addEventListener("dragover", dragOver);
        item.addEventListener("dragleave", dragLeave);
        item.addEventListener("drop", drop);
    });
</script>

</body>
</html>
